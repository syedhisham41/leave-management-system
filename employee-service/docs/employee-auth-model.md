# üõ°Ô∏è Employee‚ÄìAuth Integration Model  
### Authentication, Authorization & Cross-Service Security  
*(Internal Architecture Documentation)*

---

## üß≠ Overview

The **Employee Service** does **not** handle user login. 
The **Employee Service** does not issue JWT tokens on its own.  
All authentication is done exclusively by the **Auth Service**.

However, Employee Service performs **JWT validation and role-based authorization** for certain endpoints.

This document explains how:

- JWT tokens are generated by Auth Service  
- Employee Service validates them  
- Roles (`ADMIN`, `MANAGER`, `EMPLOYEE`) are enforced  
- Employee Service participates in secure inter-service communication  

---

## üîê JWT Token Structure (Issued by Auth Service)

Auth Service signs all JWTs using:

```env
JWT_SECRET=<shared-secret>
```

A typical token contains the following claims:

```json
{
  "employeeId": 12,
  "email": "john.doe@lms.dev",
  "role": "EMPLOYEE",
  "exp": 1714678900
}
```

### Claims Used by Employee Service

| Claim       | Purpose                                              |
|-------------|------------------------------------------------------|
| `emp_id`    | Identify the request owner                           |
| `role`      | Determine access permissions                         |
| `exp`       | Validate expiry time                                 |

---

## üîê How JWT Authentication Works

1. **Client logs in via Auth Service**  
   - Auth Service validates credentials.
   - Auth Service generates a JWT containing:
     - `emp_id`
     - `email`
     - `role` (e.g., ADMIN, MANAGER, EMPLOYEE)
     - token expiry

2. **Client invokes Employee Service API**  
   - The JWT is sent in the `Authorization: Bearer <token>` header.

3. **Employee Service validates the token**  
   - Uses `JWT_SECRET` from `.env`.
   - Checks signature, expiry, and required claims.
   - Extracts the user identity + role from the token.

4. **Authorization decisions** are made inside Employee Service based on the extracted role.

---

## üîë Role-Based Access Control (RBAC)

The Employee Service enforces strict role-based authorization to prevent cross-department or unauthorized operations.
Employee Service enforces three roles:

### `ADMIN`
- Full CRUD access to `/employee/*`
- Can create/update/delete employee records
- Can manage departments
- Can view all data

### `MANAGER`
- Can fetch employees‚Äîprimarily for approval flows
- Cannot create or delete employees
- Can query manager-related endpoints:
  - `/manager`
  - `/manager/check`

### `EMPLOYEE`
- Basic access only
- Permissions typically restricted to:
  - `/employee/get?id=<self>`
- Cannot modify or delete data
- Can query `manager/check` endpoint
- Used mainly for Auth Service self-view features or future UI dashboards

---


### **Permissions by Role**

| Operation / Endpoint              | ADMIN | MANAGER                       | EMPLOYEE      |
|----------------------------------|:-----:|:------------------------------:|:--------------:|
| Add new employee                 | ‚úì     | ‚úó                              | ‚úó              |
| Update employee                  | ‚úì     | ‚úì (same department)            | ‚úó              |
| Delete employee                  | ‚úì     | ‚úó                              | ‚úó              |
| Fetch all employees              | ‚úì     | ‚úì (department filtered)        | ‚úó              |
| Fetch single employee            | ‚úì     | ‚úì (same department)            | ‚úì (self only)  |
| Department listing               | ‚úì     | ‚úì                              | ‚úì              |
| Manager lookup (`/manager`)      | ‚úì     | ‚úì                              | ‚úó              |
| Manager check (`/manager/check`) | ‚úì     | ‚úì                              | ‚úì              |
| Debug endpoints                  | ‚úì     | ‚úì                              | ‚úì              |

---

## üß© Interaction With Auth Service

Even though Employee Service manages **employee master data**, it does **not** handle:

- login
- password management  
- token creation  
- refresh tokens  
- account status  

All of this is handled by the **Auth Service**.

### How both services work together:

#### **1. Auth Service ‚Üí Employee Service**
- When a user logs in, Auth Service fetches employee details from Employee Service to verify:
  - department
  - role
  - manager status
- Auth Service embeds these values inside the JWT.

#### **2. Employee Service ‚Üí Auth Service**
- When an employee is **deleted**, Employee Service publishes `EmployeeDeletedEvent`.
- Auth Service receives the event and cleans up:
  - login credentials  
  - tokens  
  - logged-in sessions  

#### **3. Shared Role Definitions**
Both services use the same enum:
```
Employee_role = { ADMIN, MANAGER, EMPLOYEE }
```

This ensures consistent validation across services.

---

## üì¶ Department Seeding & Default Admin User

Employee Service bootstraps crucial data during startup:

### Departments (Flyway Migration)
Seeded from `.env`:

```
DEPARTMENTS=ENG:Engineering,HR:Human Resource,GEN:General,MKT:Marketing
```

Used to enforce:
- Valid department IDs
- Manager hierarchy
- Employee role alignment

### Default Admin User
If DB is empty, service creates:

```
ADMIN_NAME=ADMIN
ADMIN_EMAIL=admin@example.com
ADMIN_DEPARTMENT=GEN
```

Role = `ADMIN`  
Used for initial system setup.

---

## üõ° Why This Design?

### ‚úî Separation of concerns  
Auth Service handles authentication.  
Employee Service handles employee metadata.

### ‚úî Security hardening  
Employee Service trusts tokens **only from Auth Service** using a shared secret (`SERVICE_SECRET`).

### ‚úî Cross-service consistency  
All role decisions are made using the **token payload**, not database calls, reducing coupling.

### ‚úî Cleaner microservice boundaries  
Employee Service is stateless in terms of authentication.  
Auth Service is stateless in terms of roles/employee records (except for credentials).

---

## üîö Summary

This document serves as the **complete architecture reference** for:

- JWT validation inside Employee Service  
- Role-based access rules  
- Cross-service secure communication  
- How Employee Service collaborates with Auth Service  
- Bootstrapping (departments + default admin)  

It is intentionally **kept separate from README** to avoid clutter, while still documenting every detail needed by developers.
